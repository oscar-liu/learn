# MySQL优化资料

## 索引的本质

索引是帮助MySQL高效获取数据的排好序的数据结构。

索引数据结构：

- 二叉树

- 红黑树

- Hash表

- B-Tree

  

## Hash

- 对索引的key进行一次hash计算就可以定位出数据存储的位置

- 很多时候Hash索引要比B+树索引更高效

- 仅能满足“=”，“IN”，不支持范围查询

- Hash冲突

为什么实际过程中很少用Hash，因为不支持范围查找。

### Hash存储、寻址过程：

​	计算数据的hash值，插入一个hash表中，表中对应维护一个链表，存储数据的磁盘地址真实数据，如果有遇到Hash碰撞，则往链接后面插入

   寻址：

直接计算HASH值，（在没有hash碰撞的情况下）假设有1亿条数据也只需查询一次，进行一次寻址过程就找到数据的真实地址。



## B+Tree

非叶子节点不存储data，只存储索引，可以放更多的索引

叶子节包含所有索引字段（冗余）

叶子节点用指针连接，提高区间访问的性能

![image-20220315213926762](/home/oscar/snap/typora/57/.config/Typora/typora-user-images/image-20220315213926762.png)

### B树和B+树的区别：

B树不维护叶子节点的指针，对范围查询不友好（又得回根节点来查找）

B树不维护冗余索引，所有数据都在叶子节点上

在大数据情况下，B树的树高要比B+树的树高要高



树的高度越小越好，B树的树高正常一定比B+树要高。



## InnoDb存储引擎索引实现（聚集）

聚焦索引：数据文件和索引在同一个文件中，只需要一次磁盘IO

非聚集索引：数据文件和索引分开文件存放，需要2次磁盘IO



### 什么建议InnoDB表必须建主键，并且推荐使用整型的自增主键？

为什么不推荐使用UUID，因为UUID是字符串，不是自增主键。

如果InnoDb表中没有建主键，Innodb会自动找某一列数据或者建一个隐藏列来建一个B+树的结构。

#### 为什么推荐整型？

- 比较范围大小整型更快。

- UUID字符串占用存储空间大



## 联合索引的底层存储结构长什么样？

单值索引 Vs 联合索引

索引最左前缀原理

![image-20220315215523912](/home/oscar/snap/typora/57/.config/Typora/typora-user-images/image-20220315215523912.png)

有索引如图示：name,age,position三个字段的联合索引

但第1个名字已经匹配到了就不会对后面的数据进行比对，当1name有重复数据时就会对age字段进行查找对比，但前面两个name,age都有相同字段的时候就会对第3个position字段进行对比。

如果是单值索引，但查询条件的时候有多个，那实际效率并没有联合索引效率高。

